<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek OCR 2</title>

    <!-- KaTeX -->
    <link rel="stylesheet" href="/static/lib/katex.min.css">
    <script src="/static/lib/katex.min.js"></script>

    <!-- markdown-it -->
    <script src="/static/lib/markdown-it.min.js"></script>

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="/static/css/style.css?v=8">
</head>
<body>
    <div id="app">

        <!-- ===== 文档库视图 ===== -->
        <div id="library-view" class="view active">
            <header class="top-bar">
                <div class="top-bar-left">
                    <h1 class="logo">DeepSeek OCR 2</h1>
                    <span class="subtitle">智能文档解析</span>
                </div>
                <div class="top-bar-right">
                    <span id="rag-status-badge" class="badge badge-gray" title="RAG 配置状态">RAG 未配置</span>
                    <button id="settings-btn" class="btn btn-ghost" title="设置">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="8" cy="8" r="2.5"/>
                            <path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.4 1.4M11.55 11.55l1.4 1.4M3.05 12.95l1.4-1.4M11.55 4.45l1.4-1.4"/>
                        </svg>
                    </button>
                    <span id="model-status-badge" class="badge badge-gray" title="模型状态">模型未加载</span>
                    <button id="upload-btn" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 1v10M4 5l4-4 4 4M2 12v2h12v-2"/>
                        </svg>
                        上传 PDF
                    </button>
                </div>
            </header>

            <main class="library-content">
                <!-- 空状态 -->
                <div id="empty-state" class="empty-state">
                    <div class="empty-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none" stroke="#cbd5e1" stroke-width="2">
                            <rect x="12" y="8" width="40" height="48" rx="4"/>
                            <path d="M22 24h20M22 32h20M22 40h12"/>
                        </svg>
                    </div>
                    <h2>还没有文档</h2>
                    <p>上传 PDF 文件开始解析</p>
                </div>

                <!-- 文档列表 -->
                <div id="document-list" class="document-grid"></div>
            </main>
        </div>

        <!-- ===== 文档查看器视图 ===== -->
        <div id="viewer-view" class="view">
            <header class="top-bar viewer-bar">
                <div class="top-bar-left">
                    <button id="back-btn" class="btn btn-ghost">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 2L4 8l6 6"/>
                        </svg>
                        返回
                    </button>
                    <span id="doc-title" class="doc-title"></span>
                </div>
                <div class="page-nav" id="page-nav">
                    <button id="prev-page" class="btn btn-ghost btn-sm" title="上一页">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 2L4 8l6 6"/>
                        </svg>
                    </button>
                    <span class="page-info">
                        <input type="number" id="page-input" class="page-input" min="1" value="1">
                        <span> / </span>
                        <span id="page-total">1</span>
                    </span>
                    <button id="next-page" class="btn btn-ghost btn-sm" title="下一页">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2l6 6-6 6"/>
                        </svg>
                    </button>
                </div>
                <div class="top-bar-right">
                    <button id="build-index-btn" class="btn btn-ghost" title="构建 RAG 索引">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M2 4h12v10H2z"/>
                            <path d="M2 7h12M5 2v2M11 2v2"/>
                        </svg>
                        构建索引
                    </button>
                    <button id="toggle-chat-btn" class="btn btn-ghost" title="AI 问答">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 8c0 3.3-2.7 6-6 6H5l-3 2v-3c-1-1-2-2.5-2-5C0 4.7 2.7 2 6 2h2c3.3 0 6 2.7 6 6z"/>
                        </svg>
                        AI 问答
                    </button>
                    <span id="viewer-status" class="badge badge-green"></span>
                </div>
            </header>

            <div id="viewer-content" class="viewer-content">
                <!-- 左侧：Markdown 渲染 -->
                <div id="markdown-pane" class="pane markdown-pane">
                    <div class="pane-header">Markdown + LaTeX</div>
                    <div id="markdown-body" class="pane-body markdown-body"></div>
                </div>

                <!-- 拖拽分隔条 -->
                <div id="resize-handle" class="resize-handle" title="拖拽调整宽度"></div>

                <!-- 中间：PDF 原页 -->
                <div id="pdf-pane" class="pane pdf-pane">
                    <div class="pane-header">PDF 原页</div>
                    <div id="pdf-body" class="pane-body pdf-body">
                        <img id="pdf-page-image" class="pdf-page-image" alt="PDF page">
                    </div>
                </div>

                <!-- 聊天面板（默认隐藏） -->
                <div id="chat-pane" class="pane chat-pane" style="display:none">
                    <div class="pane-header">
                        <span>AI 问答</span>
                        <span id="index-status-badge" class="badge badge-gray badge-sm">未建索引</span>
                    </div>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" class="chat-input" placeholder="输入问题..." disabled>
                        <button id="chat-send-btn" class="btn btn-primary btn-sm" disabled>
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 8h12M10 4l4 4-4 4"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== 上传对话框 ===== -->
        <div id="upload-modal" class="modal-overlay" style="display:none">
            <div class="modal">
                <div class="modal-header">
                    <h3>上传 PDF 文档</h3>
                    <button id="modal-close" class="btn btn-ghost btn-sm">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="drop-zone" class="drop-zone">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" stroke="#94a3b8" stroke-width="2">
                            <rect x="8" y="6" width="32" height="36" rx="3"/>
                            <path d="M18 22h12M24 16v12"/>
                        </svg>
                        <p>拖放 PDF 文件到此处</p>
                        <p class="text-muted">或点击选择文件</p>
                        <input type="file" id="file-input" accept=".pdf" style="display:none">
                    </div>
                    <div id="upload-progress" class="upload-progress" style="display:none">
                        <div class="upload-file-name" id="upload-file-name"></div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="upload-progress-bar"></div>
                        </div>
                        <div class="upload-status" id="upload-status">上传中...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== 设置对话框 ===== -->
        <div id="settings-modal" class="modal-overlay" style="display:none">
            <div class="modal modal-lg">
                <div class="modal-header">
                    <h3>RAG 设置</h3>
                    <button id="settings-close" class="btn btn-ghost btn-sm">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="provider-select">LLM 提供商</label>
                            <select id="provider-select" class="form-select">
                                <option value="openai">OpenAI</option>
                                <option value="openrouter">OpenRouter</option>
                                <option value="deepseek">DeepSeek</option>
                                <option value="custom">自定义</option>
                            </select>
                            <p class="form-hint" id="provider-hint">OpenAI 官方 API</p>
                        </div>
                        <div class="form-group" id="custom-url-group" style="display:none">
                            <label for="custom-url-input">API Base URL</label>
                            <input type="text" id="custom-url-input" class="form-input" placeholder="https://api.example.com/v1">
                            <p class="form-hint">自定义 API 端点地址</p>
                        </div>
                        <div class="form-group">
                            <label for="api-key-input">API Key</label>
                            <input type="password" id="api-key-input" class="form-input" placeholder="输入您的 API Key">
                            <p class="form-hint" id="api-key-hint">从 OpenAI 获取 API Key</p>
                        </div>
                        <div class="form-group">
                            <label for="model-path-input">DeepSeek-OCR 模型路径</label>
                            <div class="input-with-button">
                                <input type="text" id="model-path-input" class="form-input" placeholder="/path/to/deepseek-ocr-2" readonly>
                                <button type="button" id="browse-model-path-btn" class="btn btn-secondary">浏览...</button>
                            </div>
                            <p class="form-hint">DeepSeek-OCR-2 模型目录路径，默认为 /home/bsmc/deepseek-ocr-2</p>
                        </div>
                        <div class="form-group">
                            <label for="index-model-input">索引模型</label>
                            <select id="index-model-input" class="form-select">
                                <option value="">请先选择提供商</option>
                            </select>
                            <p class="form-hint" id="index-model-hint">用于构建文档索引（需要较强能力）</p>
                        </div>
                        <div class="form-group" id="custom-index-model-group" style="display:none">
                            <label for="custom-index-model-input">自定义索引模型名称</label>
                            <input type="text" id="custom-index-model-input" class="form-input" placeholder="model-name">
                            <p class="form-hint">输入索引用的模型标识符</p>
                        </div>
                        <div class="form-group">
                            <label for="chat-model-input">问答模型</label>
                            <select id="chat-model-input" class="form-select">
                                <option value="">请先选择提供商</option>
                            </select>
                            <p class="form-hint" id="chat-model-hint">用于回答问题（可用较快模型）</p>
                        </div>
                        <div class="form-group" id="custom-chat-model-group" style="display:none">
                            <label for="custom-chat-model-input">自定义问答模型名称</label>
                            <input type="text" id="custom-chat-model-input" class="form-input" placeholder="model-name">
                            <p class="form-hint">输入问答用的模型标识符</p>
                        </div>
                        <div class="form-group">
                            <label for="summary-threshold-input">摘要阈值 (tokens)</label>
                            <input type="number" id="summary-threshold-input" class="form-input" value="200" min="50" max="1000">
                            <p class="form-hint">小于此长度的内容直接显示，大于则生成摘要</p>
                        </div>
                        <div class="form-group">
                            <label for="context-length-input">模型上下文长度 (tokens)</label>
                            <input type="number" id="context-length-input" class="form-input" value="8192" min="1024" max="1000000">
                            <p class="form-hint">模型支持的最大上下文窗口，用于优化批量摘要分批策略（如 GPT-4o 填 128000，DeepSeek 填 65536）</p>
                        </div>
                        <div class="form-actions">
                            <button id="save-settings-btn" class="btn btn-primary">保存设置</button>
                        </div>
                        <div id="settings-status" class="settings-status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== 目录浏览器对话框 ===== -->
        <div id="browse-modal" class="modal-overlay" style="display:none">
            <div class="modal">
                <div class="modal-header">
                    <h3>选择模型目录</h3>
                    <button id="browse-close" class="btn btn-ghost btn-sm">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="browse-path-bar">
                        <button id="browse-parent-btn" class="btn btn-ghost btn-sm" title="上级目录">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 8h12M6 4l-4 4 4 4"/>
                            </svg>
                        </button>
                        <input type="text" id="browse-current-path" class="form-input" readonly>
                    </div>
                    <div id="browse-entries" class="browse-entries"></div>
                </div>
                <div class="modal-footer">
                    <button id="browse-cancel-btn" class="btn btn-ghost">取消</button>
                    <button id="browse-select-btn" class="btn btn-primary">选择此目录</button>
                </div>
            </div>
        </div>

    </div>

    <script src="/static/js/app.js?v=8"></script>
</body>
</html>
